## Description

Being new to eZ and combining the translated content with multiple site access successfully can be a little tricky to get you head around.

To successfully achieve this for the most typical setups you will need all 3 of following items to be considered:
1. Registering your translations in the database via the eZ admin.
1. Creating at least two site accesses to deliver the right translated content at the right time in the `ezplatform.yml`.
1. Setting the correct permissions for the anonymous user to read the site accesses.

Without all 3 steps complete your site access will either not work or you will be left with duplicate content from an SEO perspective.

## Step 1 - Create your new translation
Here is the full guide on [Internationalization](../guide/internationalization.md)
1. Log into your ez admin
1. Navigate to the Admin Panel -> Languages tab
1. Click the button "Create a new language" and simply follow the on screen prompts to register your new language (eg: `fre-FR`)
1. After saving the new language you then need to refresh the eZ admin assets: `php app/console assetic:dump`

That's it! Reload the admin and you can now start translating content.

## Step 2 - Creating the new site accesses
Here is the full guide on [SiteAccess](../guide/siteaccess.md)

The most typical setup for a site with translated content is to map the base of the domain to one language and using the first segment of the URI to match to another. For example:
- www.mysite.com to match to English
- www.mysite.com/fr to match to French

To achieve this you will need to create at least two site accesses in your `ezplatform.yml` file.

In the first bit of this working example, we declare `en` to be the default site access meaning if nothing else matches use the `en` site access. We then list the available site accesses for this site as well as add them both to a common group `site_group` (this will be used for shared settings such as api keys and cache locations etc.).
```
    siteaccess:
        default_siteaccess: en
        list:
            - en
            - fr
        groups:
            site_group:
                - en
                - fr
```

The second section of the site access block we declare what matches to which site access. In the example below we have two matches, the first is a simple host match, when the host is `www.mysite.com` the match is `en`. The second when the host and URI both match we hit the `fr` site access, ie, when the URI is `/fr` and the host is `www.mysite.com`. For a full list of available matchers see [Siteaccess Matching.](../guide/siteaccess.md#siteaccess-matching)
```
    siteaccess:
        default_siteaccess: en
        list:
            - en
            - fr
        groups:
            site_group:
                - en
                - fr
        match:
            Compound\LogicalAnd:
                frLogicalAndMatch:
                    matchers:
                        Map\URI: { fr: true }
                        Map\Host: { www.mysite.com: true }
                    match: fr
            Map\Host:
                www.mysite.com: en
```

Further down the `ezplatform.yml` is the system section which comes with the default group named `site_group` (the same one we added to earlier). After this point we register the site access languages:
```
    system:
        site_group:
            api_keys: { google_maps: "yourapikey" }
            cache_pool_name: '%cache_pool%'
            var_dir: var/site
            translation_siteaccesses: [fr, en]
        fr:
            languages: [fre-FR, eng-GB]
        en:
            languages: [eng-GB]
        default:
            content:
                ... tpl override common to both the en and fr siteaccess
```

That's it! The `ezplatform.yml` with site accesses should now be configured. Clear to cache to complete the job: 
```
php app/console cache:clear
```

## Step 3 - Setting the permissions for the fr and en site access
The last step is to now allow the user role anonymous to read content on the new site accesses. 

If your are trialing this on a new installation you will immediately hit a problem, your browser should be redirecting you to a login screen which most likely displays an ugly error page. This is because in Step 2 we only left the installation with 2 site accesses of which nobody has permission to read yet. To fix this, we need to temporarily add back in the default siteaccess `site` giving us access again to the eZ admin:
```
    siteaccess:
        default_siteaccess: site
        list:
            - site
            - en
            - fr
        groups:
            site_group:
                - site
                - en
                - fr
```

Clear the cache again and you should be able to load the admin once more:
```
php app/console cache:clear
```
Last but not least, fix the permissions for Anonymous:
1. Login into the eZ admin
1. Navigate to Admin Panel -> Roles
1. Click the role `Anonymous`
1. Edit the limitations of the module `user`.
1. You should be able to see 3 site access in a multi-select, select them all and press save.
1. In your `ezplatform.yml` revert to `default_siteaccess: en` and remove site from the `list` and `groups`.
1. Clear the cache once more and you are good to go.

## Conclusion
If you followed all 3 steps you should now be able to load your ezplatform site in the `en` and `fr` siteaccess displaying English and French content.
